import{_ as M,o as N,a as e,c as o,b as i,F as m,r as _,d as h,u as D,t as c,e as p,w as k,f as g,n as y,g as C,I,h as S}from"./index-CrVrwAiP.js";import{p as V}from"./index-NDcc4Jqj.js";import{m as b}from"./media-DeF6Y4tT.js";const B={class:"feed-page"},L={key:0,class:"loading"},$={key:1,class:"empty"},E={key:2,class:"feed-list"},F=["onClick"],H={class:"post-meta"},T={class:"author"},W={class:"time"},j={key:0,class:"post-content"},O=["data-post-id"],P=["src","alt","onClick"],R=["src"],U={key:0,class:"media-dots"},q={class:"post-actions"},A={class:"action-item"},G={class:"action-item"},J={__name:"Home",setup(K){const w=D(),d=h([]),v=h(!0),r=h({});function x(a){return a?new Date(a).toLocaleString("zh-CN"):""}function f(a){w.push({name:"PostDetail",params:{id:a}})}function z(a){var n;const s=a.target,t=(n=s.dataset)==null?void 0:n.postId;if(!t||!s.scrollWidth)return;const u=Math.round(s.scrollLeft/s.clientWidth);r.value={...r.value,[t]:Math.min(u,s.children.length-1)}}return N(async()=>{try{const{data:a}=await V.list({limit:20}),s=a.list||[];d.value=s,r.value=Object.fromEntries(s.map(t=>[t.id,0]))}catch{d.value=[]}finally{v.value=!1}}),(a,s)=>(e(),o("div",B,[s[2]||(s[2]=i("h1",{class:"page-title"},"内容流",-1)),v.value?(e(),o("div",L,"加载中...")):d.value.length===0?(e(),o("div",$,"暂无帖子，去发一条吧")):(e(),o("div",E,[(e(!0),o(m,null,_(d.value,t=>{var u;return e(),o("article",{key:t.id,class:"card post-card",onClick:n=>f(t.id)},[i("div",H,[i("span",T,c(((u=t.user)==null?void 0:u.nickname)||"用户"+(t.user_id||"").toString().slice(-4)),1),i("span",W,c(x(t.created_at)),1)]),t.content?(e(),o("p",j,c(t.content),1)):p("",!0),t.media&&t.media.length?(e(),o("div",{key:1,class:"post-media-wrap",onClick:s[1]||(s[1]=k(()=>{},["stop"]))},[i("div",{class:y(["post-media-scroll",{"has-multi":t.media.length>1}]),"data-post-id":t.id,onScroll:z},[(e(!0),o(m,null,_(t.media,(n,l)=>(e(),o("div",{key:n.id||l,class:"post-media-slide"},[n.type==="image"?(e(),o("img",{key:0,src:g(b)(n.url),alt:`图片 ${l+1}`,class:"post-thumb",loading:"lazy",onClick:Q=>f(t.id)},null,8,P)):(e(),o("video",{key:1,src:g(b)(n.url),class:"post-thumb post-video",controls:"",playsinline:"",muted:"",onClick:s[0]||(s[0]=k(()=>{},["stop"]))},null,8,R))]))),128))],42,O),t.media.length>1?(e(),o("div",U,[(e(!0),o(m,null,_(t.media,(n,l)=>(e(),o("span",{key:l,class:y(["dot",{active:r.value[t.id]===l}])},null,2))),128))])):p("",!0)])):p("",!0),i("div",q,[i("span",A,[C(I,{name:"heart",size:"sm"}),S(" "+c(t.like_count??0),1)]),i("span",G,[C(I,{name:"chat",size:"sm"}),S(" "+c(t.comment_count??0),1)])])],8,F)}),128))]))]))}},tt=M(J,[["__scopeId","data-v-1d46dcb2"]]);export{tt as default};
