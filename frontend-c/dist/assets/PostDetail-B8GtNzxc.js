import{_ as L,i as F,o as M,a,c as s,b as t,t as l,e as h,F as k,r as x,g as C,I as D,h as P,f as y,j as U,v as $,d as c,k as j,l as A}from"./index-CrVrwAiP.js";import{p as E,c as f,l as N}from"./index-NDcc4Jqj.js";import{m as S}from"./media-DeF6Y4tT.js";const R={key:0,class:"loading"},q={key:1,class:"detail-page"},G={class:"card post-detail"},H={class:"post-meta"},J={class:"author"},K={class:"time"},O={key:0,class:"post-content"},Q={key:1,class:"post-media-list"},W=["src","alt"],X=["src"],Y={class:"post-actions"},Z=["aria-pressed"],tt={class:"action-item"},et={class:"comments-section card"},at={key:0,class:"comment-form"},st={class:"comment-list","aria-label":"评论列表"},ot={class:"comment-author"},nt={class:"comment-content"},lt={key:2,class:"empty"},ct={__name:"PostDetail",setup(it){const V=A(),g=F(),o=c(null),v=c(0),p=c(0),m=c(!1),_=c([]),d=c(""),b=c(!0),i=j(()=>V.params.id);function z(e){return e?new Date(e).toLocaleString("zh-CN"):""}async function T(){try{const{data:e}=await E.get(i.value);o.value=e.post,v.value=e.like_count??0,p.value=e.comment_count??0;const{data:u}=await f.list(i.value,{limit:50});_.value=u.list||[]}catch{o.value=null}finally{b.value=!1}}async function B(){if(g.token)try{m.value?(await N.unlike(i.value),v.value--):(await N.like(i.value),v.value++),m.value=!m.value}catch(e){console.error(e)}}async function I(){if(d.value.trim())try{await f.create(i.value,{content:d.value.trim()}),d.value="";const{data:e}=await f.list(i.value,{limit:50});_.value=e.list||[],p.value=_.value.length}catch(e){console.error(e)}}return M(T),(e,u)=>{var w;return b.value?(a(),s("div",R,"加载中...")):o.value?(a(),s("div",q,[t("article",G,[t("div",H,[t("span",J,l(((w=o.value.user)==null?void 0:w.nickname)||"用户"),1),t("span",K,l(z(o.value.created_at)),1)]),o.value.content?(a(),s("p",O,l(o.value.content),1)):h("",!0),o.value.media&&o.value.media.length?(a(),s("div",Q,[(a(!0),s(k,null,x(o.value.media,(n,r)=>(a(),s(k,null,[n.type==="image"?(a(),s("img",{key:"img-"+r,src:y(S)(n.url),alt:`图片 ${r+1}`,class:"media-item",loading:"lazy"},null,8,W)):(a(),s("video",{key:"vid-"+r,src:y(S)(n.url),class:"media-item",controls:"",playsinline:""},null,8,X))],64))),256))])):h("",!0),t("div",Y,[t("button",{type:"button",class:"btn btn-ghost btn-icon action-btn",onClick:B,"aria-pressed":m.value},[C(D,{name:m.value?"heartSolid":"heart",size:"md"},null,8,["name"]),t("span",null,l(v.value),1)],8,Z),t("span",tt,[C(D,{name:"chat",size:"md"}),P(" "+l(p.value),1)])])]),t("section",et,[u[1]||(u[1]=t("h2",{class:"comments-title"},"评论",-1)),y(g).token?(a(),s("div",at,[U(t("textarea",{"onUpdate:modelValue":u[0]||(u[0]=n=>d.value=n),placeholder:"写评论...",rows:"3",class:"comment-input","aria-label":"评论内容"},null,512),[[$,d.value]]),t("button",{type:"button",class:"btn btn-primary",onClick:I},"发送")])):h("",!0),t("ul",st,[(a(!0),s(k,null,x(_.value,n=>{var r;return a(),s("li",{key:n.id,class:"comment-item"},[t("strong",ot,l(((r=n.user)==null?void 0:r.nickname)||"用户"),1),t("span",nt,l(n.content),1)])}),128))])])])):(a(),s("div",lt,"未找到帖子"))}}},dt=L(ct,[["__scopeId","data-v-dde9f7e8"]]);export{dt as default};
