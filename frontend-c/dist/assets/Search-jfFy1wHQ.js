import{_ as V,a as s,c as a,b as o,j as B,v as L,m as T,F as p,r as y,e as h,d as c,u as $,t as d,w as b,f as w,n as C,g as S,I as x,h as I}from"./index-CrVrwAiP.js";import{p as j}from"./index-NDcc4Jqj.js";import{m as z}from"./media-DeF6Y4tT.js";const E={class:"search-page"},F={class:"search-form card"},K={class:"form-group",style:{"margin-bottom":"0"}},U={key:0,class:"loading"},W={key:1,class:"empty"},O={key:2,class:"feed-list"},P=["onClick"],R={class:"post-meta"},q={class:"author"},A={class:"time"},G={key:0,class:"post-content"},H=["data-post-id"],J=["src","alt","onClick"],Q=["src"],X={key:0,class:"media-dots"},Y={class:"post-actions"},Z={class:"action-item"},tt={class:"action-item"},et={__name:"Search",setup(st){const D=$(),_=c(""),l=c([]),v=c(!1),f=c(!1),u=c({});function M(n){return n?new Date(n).toLocaleString("zh-CN"):""}function k(n){D.push({name:"PostDetail",params:{id:n}})}function N(n){var i;const e=n.target,t=(i=e.dataset)==null?void 0:i.postId;if(!t||!e.scrollWidth)return;const m=Math.round(e.scrollLeft/e.clientWidth);u.value={...u.value,[t]:Math.min(m,e.children.length-1)}}async function g(){f.value=!0,v.value=!0;try{const{data:n}=await j.list({keyword:_.value,limit:20}),e=n.list||[];l.value=e,u.value=Object.fromEntries(e.map(t=>[t.id,0]))}catch{l.value=[]}finally{v.value=!1}}return(n,e)=>(s(),a("div",E,[e[4]||(e[4]=o("h1",{class:"page-title"},"搜索 / 话题",-1)),o("div",F,[o("div",K,[e[3]||(e[3]=o("label",{for:"search-keyword"},"关键词",-1)),B(o("input",{id:"search-keyword","onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),type:"search",placeholder:"输入关键词搜索",onKeyup:T(g,["enter"]),"aria-label":"搜索关键词"},null,544),[[L,_.value]])]),o("button",{type:"button",class:"btn btn-primary",onClick:g},"搜索")]),v.value?(s(),a("div",U,"加载中...")):l.value.length===0&&f.value?(s(),a("div",W,"无结果")):l.value.length?(s(),a("div",O,[(s(!0),a(p,null,y(l.value,t=>{var m;return s(),a("article",{key:t.id,class:"card post-card",onClick:i=>k(t.id)},[o("div",R,[o("span",q,d(((m=t.user)==null?void 0:m.nickname)||"用户"+(t.user_id||"").toString().slice(-4)),1),o("span",A,d(M(t.created_at)),1)]),t.content?(s(),a("p",G,d(t.content),1)):h("",!0),t.media&&t.media.length?(s(),a("div",{key:1,class:"post-media-wrap",onClick:e[2]||(e[2]=b(()=>{},["stop"]))},[o("div",{class:C(["post-media-scroll",{"has-multi":t.media.length>1}]),"data-post-id":t.id,onScroll:N},[(s(!0),a(p,null,y(t.media,(i,r)=>(s(),a("div",{key:i.id||r,class:"post-media-slide"},[i.type==="image"?(s(),a("img",{key:0,src:w(z)(i.url),alt:`图片 ${r+1}`,class:"post-thumb",loading:"lazy",onClick:at=>k(t.id)},null,8,J)):(s(),a("video",{key:1,src:w(z)(i.url),class:"post-thumb post-video",controls:"",playsinline:"",muted:"",onClick:e[1]||(e[1]=b(()=>{},["stop"]))},null,8,Q))]))),128))],42,H),t.media.length>1?(s(),a("div",X,[(s(!0),a(p,null,y(t.media,(i,r)=>(s(),a("span",{key:r,class:C(["dot",{active:u.value[t.id]===r}])},null,2))),128))])):h("",!0)])):h("",!0),o("div",Y,[o("span",Z,[S(x,{name:"heart",size:"sm"}),I(" "+d(t.like_count??0),1)]),o("span",tt,[S(x,{name:"chat",size:"sm"}),I(" "+d(t.comment_count??0),1)])])],8,P)}),128))])):h("",!0)]))}},lt=V(et,[["__scopeId","data-v-0b25f700"]]);export{lt as default};
