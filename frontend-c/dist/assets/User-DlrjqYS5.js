import{_ as M,o as N,a as e,c as a,b as i,F as m,r as _,d as h,u as D,t as c,e as p,w as k,f as y,n as g,g as C,I,h as S}from"./index-CrVrwAiP.js";import{p as V}from"./index-NDcc4Jqj.js";import{m as b}from"./media-DeF6Y4tT.js";const B={class:"user-page"},L={key:0,class:"loading"},U={key:1,class:"empty"},$={key:2,class:"feed-list"},E=["onClick"],F={class:"post-meta"},P={class:"author"},T={class:"time"},W={key:0,class:"post-content"},j=["data-post-id"],O=["src","alt","onClick"],R=["src"],q={key:0,class:"media-dots"},A={class:"post-actions"},G={class:"action-item"},H={class:"action-item"},J={__name:"User",setup(K){const w=D(),d=h([]),v=h(!0),r=h({});function x(o){return o?new Date(o).toLocaleString("zh-CN"):""}function f(o){w.push({name:"PostDetail",params:{id:o}})}function z(o){var n;const s=o.target,t=(n=s.dataset)==null?void 0:n.postId;if(!t||!s.scrollWidth)return;const u=Math.round(s.scrollLeft/s.clientWidth);r.value={...r.value,[t]:Math.min(u,s.children.length-1)}}return N(async()=>{try{const{data:o}=await V.myPosts({limit:50}),s=o.list||[];d.value=s,r.value=Object.fromEntries(s.map(t=>[t.id,0]))}catch{d.value=[]}finally{v.value=!1}}),(o,s)=>(e(),a("div",B,[s[2]||(s[2]=i("h1",{class:"page-title"},"我的帖子",-1)),v.value?(e(),a("div",L,"加载中...")):d.value.length===0?(e(),a("div",U,"暂无帖子")):(e(),a("div",$,[(e(!0),a(m,null,_(d.value,t=>{var u;return e(),a("article",{key:t.id,class:"card post-card",onClick:n=>f(t.id)},[i("div",F,[i("span",P,c(((u=t.user)==null?void 0:u.nickname)||"用户"+(t.user_id||"").toString().slice(-4)),1),i("span",T,c(x(t.created_at)),1)]),t.content?(e(),a("p",W,c(t.content),1)):p("",!0),t.media&&t.media.length?(e(),a("div",{key:1,class:"post-media-wrap",onClick:s[1]||(s[1]=k(()=>{},["stop"]))},[i("div",{class:g(["post-media-scroll",{"has-multi":t.media.length>1}]),"data-post-id":t.id,onScroll:z},[(e(!0),a(m,null,_(t.media,(n,l)=>(e(),a("div",{key:n.id||l,class:"post-media-slide"},[n.type==="image"?(e(),a("img",{key:0,src:y(b)(n.url),alt:`图片 ${l+1}`,class:"post-thumb",loading:"lazy",onClick:Q=>f(t.id)},null,8,O)):(e(),a("video",{key:1,src:y(b)(n.url),class:"post-thumb post-video",controls:"",playsinline:"",muted:"",onClick:s[0]||(s[0]=k(()=>{},["stop"]))},null,8,R))]))),128))],42,j),t.media.length>1?(e(),a("div",q,[(e(!0),a(m,null,_(t.media,(n,l)=>(e(),a("span",{key:l,class:g(["dot",{active:r.value[t.id]===l}])},null,2))),128))])):p("",!0)])):p("",!0),i("div",A,[i("span",G,[C(I,{name:"heart",size:"sm"}),S(" "+c(t.like_count??0),1)]),i("span",H,[C(I,{name:"chat",size:"sm"}),S(" "+c(t.comment_count??0),1)])])],8,E)}),128))]))]))}},tt=M(J,[["__scopeId","data-v-dda65b08"]]);export{tt as default};
